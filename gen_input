#!/bin/bash

for protocol in MESI MOESI Dragon
do
  for input in blackscholes_four/blackscholes bodytrack_four/bodytrack fluidanimate_four/fluidanimate
  do
    for cache_size_log2 in $(seq 0 20)
    do
      for associativity_log2 in $(seq 0 "$cache_size_log2")
      do
        for block_size_log2 in $(seq 0 "$cache_size_log2")
        do
          cache_size=$(bc <<< "2^$cache_size_log2")
          associativity=$(bc <<< "2^$associativity_log2")
          block_size=$(bc <<< "2^$block_size_log2")
          num_blocks=$(bc <<< "$cache_size/$block_size")
          num_sets=$(bc <<< "$num_blocks/$associativity")
          if [[ $(factor "$num_sets" | sed 's/.*: //' | sed 's/2//g' | sed 's/ //g') == "" ]]
          then
            echo $protocol $input "$cache_size" "$associativity" "$block_size"
          fi
        done
      done
    done
  done
done
